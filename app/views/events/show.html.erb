<div class="card p-4">
  <div>
    <div class="d-flex ">
      <%= cl_image_tag @event.photo.key, :crop => :fill, :object_fit => :cover, class: "img-container rounded-4" %>
    </div>
    <div class="">
      <h1 class="pt-4"><%= @event.title %></h1>
      <hr/>
      <h5><%= @event.content %></h5>
      <p><i class="fa-solid fa-location-dot"></i> <%= @event.location %></p>
      <p><i class="fa-regular fa-clock"></i> <%= @event.date.strftime('%B %d') %> at <%= @event.time.strftime('%H:%M') %> JST</p>
      <%# old %>
      <%# <p>Hosted by  %>
        <%#= @event.user == current_user ? "You" : @event.user.username %>
      <%# </p> %>
      
      <div class= "d-flex py-2 gap-2 ">
        <p class="">Hosted by: </p>  
        <% if @event.user.avatar_cl.attached? %>
          <%= cl_image_tag(@event.user.avatar_cl.key, width: "20", height: "20") %>
        <% elsif @event.user.avatar %>
          <%= image_tag(@event.user.avatar, width: "20", height: "20") %>
        <% else %>
          <%= image_tag("userF1.png", width: "20", height: "20") %>
        <% end %>
        <div class="d-flex flex-column justify-content-center position-relative">
          <p class=""><strong><%= @event.user == current_user ? "You" : @event.user.username %></strong></p>
          <% unless @event.user == current_user %>
            <%=  render "conversations/newsmall", user: @event.user, conversation: @conversation, size: "2xs"%>
          <% end %>
        </div>
        
      </div>
      <p>
        <i class="fa-solid fa-circle-check"></i>
        <% attending = @event.attendants %>
        <% all = attending.count + 1 %>
        <%= all %> going
      </p>
    </div>
  </div>


 <% if @event.user != current_user %>
    <div class="d-flex flex-column align-items-center mt-3">
      <%# <h3>Status: <%= @is_attending ? 'Attending' : 'Not attending' %>
      <% if @is_attending %>
        <h3>Status: Attending </h3>
        <%= link_to 'Decline', status_change_path({ event: @event, status: 2 }), method: "post", class: "btn btn-danger mt-2" %>
      <% elsif @event.user.status = 0 %>
        <%= link_to 'Accept', status_change_path({ event: @event, status: 1 }), method: "post", class: "btn btn-success mt-2" %>
      <% else %>
        <h3>Status: Not attending </h3>
        <%= link_to 'Accept', status_change_path({ event: @event, status: 1 }), method: "post", class: "btn btn-success mt-2" %>
      <% end %>
    </div>
  <% end %>

  <% if policy(@event).destroy? %>
    <div class="d-flex justify-content-center mt-3">
      <%= link_to "Delete this event", event_path(@event), class: "btn btn-danger mt-2",
        data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>
    </div>
  <% end %>
</div>
